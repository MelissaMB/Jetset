<!DOCTYPE html>
<html lang="pt" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="'layout/MainlyLayout'">

<head>
    <title>Solicitudes</title>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

</head>

<body>

<section layout:fragment="content">
    <div class="container-fluid">
        <div style="margin-top: 60px;">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="clearfix">
                        <h2 style="float: left;">Solicitudes de acceso al sistema</h2>
                    </div>
                </div>
                <div class="panel-body">

                    <div class="table-responsive" >
                        <table class="table table-bordered table-striped "
                               style="margin-top: 60px;">
                            <thead>
                            <tr>
                                <td>Nombre</td>
                                <td>Apellidos</td>
                                <td>Sexo</td>
                                <td>#</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr  th:if="${obj.usuario}==null"  th:each="obj : ${solicitudesList}" >
                                <td  th:text="${obj.primerNombre} + ${obj.SegundoNombre}"></td>
                                <td  th:text="${obj.primerApellido} +${obj.segundoApellido}"></td>
                                <td  th:text="${obj.sexo}"></td>
                                <td>
                                    <button id="btn-reserva" type="button"
                                            th:attr="   data-nombre=${obj.getPrimerNombre()},
                                                        data-nombreS=${obj.getSegundoNombre()},
                                                        data-apellido=${obj.getPrimerApellido()},
                                                        data-apellidoS=${obj.getSegundoApellido()},
                                                        data-sexo=${obj.getSexo()},
                                                        data-email=${obj.getEmail()},
                                                        data-detalle=${obj.getDescripcion()},
                                                        data-id=${obj.getId()}"
                                            class="btn btn-primary btn-sm">Detalle
                                    </button>
                                </td>


                            </tr>
                            <tr>
                                <td colspan="12" th:if="${#lists.isEmpty(pagina.conteudo)}">No
                                    records found
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="col-sm-12  text-center"
                             th:if="${not #lists.isEmpty(pagina.conteudo)}">
                            <nav>
                                <ul class="center pagination" th:if="${not pagina.vazia}"
                                    th:with="paginaAtual=${pagina.atual}">
                                    <li th:if="${not pagina.primeira}"
                                        th:class="${pagina.primeira} ? disabled"><a
                                            th:href="${pagina.urlParaPagina(paginaAtual - 1)}"
                                            th:remove="${pagina.primeira} ? tag"> <i> <</i>
                                    </a></li>

                                    <li th:if="${(paginaAtual - 2) > 0}"><a
                                            th:href="${pagina.urlParaPagina(0)}">1 <span>...</span>
                                    </a></li>

                                    <th:block th:each="p : ${#numbers.sequence(1, pagina.total)}"
                                              th:with="numeroPagina = ${p - 1} ">
                                        <li
                                                th:if="${(p + 1 >= paginaAtual and p - 1 <= paginaAtual + 2)}"
                                                th:class="${paginaAtual == numeroPagina} ? 'active deep-purple darken-4' : 'waves-effect' ">
                                            <a th:href="${pagina.urlParaPagina(numeroPagina)}"
                                               th:text="${p}">1</a>
                                        </li>
                                    </th:block>

                                    <li th:if="${(paginaAtual + 3) < pagina.total}"><a
                                            th:href="${pagina.urlParaPagina(pagina.total - 1)}"> ...
                                        <span th:text="${pagina.total}"></span>
                                    </a></li>

                                    <li th:class="${pagina.ultima} ? disabled"><a
                                            th:if="${not pagina.ultima}"
                                            th:href="${pagina.urlParaPagina(paginaAtual + 1)}"
                                            th:remove="${pagina.ultima} ? tag"> <i>></i>
                                    </a></li>
                                </ul>
                            </nav>
                        </div>
                        <!--Modal-->
                        <div class="modal fade" id="myModal" role="dialog">
                            <div class="modal-dialog">

                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header" style="padding:35px 50px;">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4><span class="glyphicon glyphicon-lock"></span> Solicitud de acceso</h4>
                                    </div>
                                    <div class="modal-body" style="padding:40px 50px;">
                                        <div class="form-group">
                                            <label><strong>Nombres: </strong></label>
                                            <label id="label-nombre"></label>
                                        </div>

                                        <div class="form-group">
                                            <label><strong>Apellidos: </strong></label>
                                            <label id="label-apellido"></label>
                                        </div>
                                        <div class="form-group">
                                            <label><strong>sexo: </strong></label>
                                            <label id="label-sexo"></label>
                                        </div>

                                        <div class="form-group">
                                            <label><strong>email: </strong></label>
                                            <label id="label-email"></label>
                                        </div>

                                        <div class="form-group">
                                            <label><strong>Detalle de solicitud: </strong></label>
                                            <label id="label-detalle"></label>
                                        </div>
                                        <div class="form-group">
                                            <label><strong>Rol</strong></label>
                                            <select class="select form-control">
                                                <option value="">Select</option>
                                                <option th:each="gclass : ${rolList}" th:value="${gclass.id}"
                                                        th:text="${gclass.nombre}"></option>
                                            </select>
                                        </div>
                                        <br>
                                        <br>
                                        <button type="submit" id="btn-reservar" class="btn btn-success btn-block"><span
                                                class="glyphicon glyphicon-off"></span> Aceptar
                                        </button>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" id="btn-cancel"
                                                class="btn btn-danger btn-default pull-left" data-dismiss="modal"><span
                                                class="glyphicon glyphicon-remove"></span> Cancel
                                        </button>

                                    </div>
                                </div>

                            </div>
                        </div>


                    </div>
                </div>


            </div>


        </div>
    </div>

</section>
<th:block layout:fragment="javascript-extra">

    <script>
        $(document).ready(function () {
            $(".btn").on("click", function () {
                let nombre = $(this).data('nombre');
                let nombreS = $(this).data('nombreS');
                let apellido = $(this).data('apellido');
                let apellidoS = $(this).data('apellidoS');
                let sexo = $(this).data('sexo');
                let email = $(this).data('email');
                let detalle = $(this).data('detalle');
                let id = $(this).data('id');


                $("#myModal").modal();
                $("#label-nombre").text(nombre);
                $("#label-apellido").text(apellido);
                $("#label-sexo").text(sexo);
                $("#label-email").text(email);
                $("#label-detalle").text(detalle);


                $("#btn-reservar").on("click", {id: id}, Enroll);

            });

            function Enroll(event) {
                let id = event.data.id;
                let rol = $("select.select").val();

                Swal.fire({
                    title: 'Confirmación',
                    text: "¿Desea aceptar la solicitud?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Si, aceptar!'
                }).then((result) => {
                    if (result.value) {
                        let url = "/usuario/sistema/list/" + id + "/" + rol;
                        axios.get(url).then(function (response) {
                            Swal.fire(
                                'Registro usuario!',
                                'Registro de usuario exitoso.',
                                'success'
                            )
                            window.location.reload();
                        }).catch(function (error) {
                            console.log(error);

                        })

                    }
                })
            }


        })

    </script>


</th:block>
</body>

</html>
